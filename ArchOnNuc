#############################################
# How to install Arch Linux on an Intel Nuc #
#############################################

#Check the internet connection, must be wired
ping -c 3 www.google.com
#Check if you are in efi mode
efivar -l

#Preparation of the hard drive

#Identify the devices
lsblk
#We consider that we will install Arch on "sda"
#Partition table
gdisk /dev/sda
#Then press : x, x, z, Y, Y

#Partitions
cgdisk
/dev/sda
#Press "Enter" at new partition
512MiB
EF00
"Linux Boot"
#Press "Enter" at new partition
4GiB
8200
"Linux Swap"
#Press "Enter" at new partition
#Press : Enter
#Press : Enter
"Arch Linux"

#Format
#First, we have to check if everything is fine
lsblk
#Boot
mkfs.fat -F32 /dev/sda1
#Swap
mkswap /dev/sda2
swapon /dev/sda2
#Check if swap is active
free -m
#Home
mkfs.ext4 /dev/sda3

#Mount
mount /dev/sda3 /mnt
mkdir /mnt/boot
mkdir /mnt/home
mount /dev/sda1 /mnt/boot
mount /dev/sda3 /mnt/home

#Mirrorlist
cp /etc/pacman.d/mirrorlist /etc/pacman.d/mirrorlist.backup
sed -i 's/^#Server/Server/' /etc/pacman.d/mirrorlist.backup
rankmirrors -n 6 /etc/pacman.d/mirrorlist.backup > /etc/pacman.d/mirrorlist

#Base package
pacstrap -i /mnt base base-devel

#Generate the fstab file
genfstab -U -p /mnt >> /mnt/etc/fstab
nano /mnt/etc/fstab
#Change this line "/dev/sda2 none swap defaults,discard 0 0"

#Chroot
arch-chroot /mnt /bin/bash
#Locale
nano /etc/locale.gen
#Uncomment en_US.UTF-8
locale-gen
echo LANG=en_US.UTF-8 > /etc/locale.conf

#Time
ln -s /usr/share/zoneinfo/Europe/Paris > /etc/localtime
hwclock --systohc --utc

#Hostname
echo dude > /etc/hostname

#Pacman and Yaourt
nano /etc/pacman.conf
#Uncomment : [multilib] and the line after it
#Add at the end
    [archlinuxfr]
    SigLevel = Never
    Server = http://repo.archlinux.fr/$arch
#Update pacman
pacman -Sy
#Install Yaourt (AUR)
pacman -S yaourt
#Install Intel image
pacman -S intel-ucode
#Install bash completion
pacman -S bash-completion

#Root password
passwd

#Creation of a new user
useradd -m -g users -G wheel,storage,power -s /bin/bash gawk
passwd gawk

EDITOR=nano visudo
#Uncomment and add
    %wheel ALL=(ALL) ALL
    Defaults rootpw

#Boot loader
bootctl install
#Creat arch.conf
nano /boot/loader/entries/arch.conf
#Add
    title Arch Linux
    linux /vmlinuz-linux
    initrd /intel-ucode.img
    initrd /initramfs-linux.img
    options root=/dev/sda3 rw

#Quit
exit
umount -R /mnt
reboot

#Wired
#Check internet connection
ip link
#We want the wired one here : enp3s0
sudo systemctl enable dhcpcd@enp3s0.service
sudo systemctl start dhcpcd@enp3s0.service

#Software
#Upgrade everything
sudo pacman -Syu
#Video dirvers
sudo pacman -S xf86-video-intel mesa
#Xorg
sudo pacman -S xorg-server xorg-server-utils xorg-xinit 
#Terminal
sudo pacman -S termite
#Neovim
sudo pacman -S neovim python2-neovim python-neovim
#Sound
sudo pacman -S alsa-utils 
#Automount
sudo pacman -S udiskie
#Python
sudo pacman -S python python2 python-pip python2-pip
#Freebox
sudo pacman -S cifs-utils 
#Mail
sudo pacman -S mutt
#Android tools
sudo pacman -S android-tools
#Transparency
sudo pacman -S compton
#Firefox
sudo pacman -S firefox 
mpv 
ranger 
wget 
feh 
zip unzip 
redshift 
htop 
slim 
scrot 
openssh 
gimp 
rsync 
ntfs-3g 
yaourt -S phallus-fonts-git concalc lemonbar-git dmenu2 #xprintidle
yaourt -S hsetroot

#Vim setup
#Vim-plug
curl -fLo ~/.config/nvim/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
cd .config
mkdir nvim
cd nvim
touch init.vim
nvim init.vim #add this at the end of the file
     runtime! archlinux.vim
     
     set number
     filetype plugin on
     syntax on
     
     call plug#begin()
     Plug 'junegunn/goyo.vim'
     Plug 'junegunn/limelight.vim'
     call plug#end()
:PlugInstall #inside vim software


#Bluetooth
sudo pacman bluez bluez-utils
sudo systemctl enable bluetooth.service
sudo systemctl start bluetooth.service
sudo hciconfig hci0 up #Without that bluetoothwtl won't work
bluetoothctl
sudo nano /etc/udev/rules.d/10-local.rules: #Start bluetooth everytime
  #Set bluetooth power up 
  ACTION=="add", KERNEL=="hci0", RUN+="/usr/bin/hciconfig hci0 up"

#Firefox
extension firefox :
  stylish
  custom new tab
  ghostery
  HTTPS everywhere
  lastpass
  ublock origin
  CTR
# file:///home/gawk/.config/firefox/page/index.html

#Login manager
sudo systemctl enable slim.service
sudo nano /etc/slim.conf
cd /usr/share/slim/themes/
sudo git clone https://github.com/naglis/slim-minimal.git

#Ssh
sudo pacman -S openssh
sudo systemctl enable sshd.service
sudo systemctl start sshd.service
#hostname -i #if you want to know your local ip

#Syncthing
sudo pacman -S syncthing
#http://docs.syncthing.net/users/autostart.html#using-systemd
sudo systemctl enable syncthing@gawk.service
sudo systemctl start syncthing@gawk.service
